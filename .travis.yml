language: cpp
sudo: required
cache: ccache

matrix:
  include:
    # Ubuntu 14.04 + GCC 4.8 + Qt 5.2 + Doxygen Generation (all packages from official Ubuntu repositories)
    # - os: linux
    #   dist: trusty
    #   compiler: gcc
    #   env: BUILD_DOXYGEN=true QT_BASE="trusty"
    # Ubuntu 14.04 + Clang + Latest Qt from beineri PPA (https://launchpad.net/~beineri)
    - os: linux
      dist: trusty
      compiler: clang
      env: BUILD_DOXYGEN=false QT_BASE="qt57" QT_PPA="ppa:beineri/opt-qt57-trusty"
  fast_finish: true

before_install:
  - | 
    if [ -n "$QT_PPA" ]
    then
      sudo add-apt-repository "${QT_PPA}" -y && sudo apt-get update -qq
    fi

install:
  - |
    if [ "${TRAVIS_OS_NAME}" = "linux" ]
    then
      sudo apt-get install -qq libglu1-mesa-dev xvfb
      if [ "$QT_BASE" = "trusty" ]; then sudo apt-get install -qq qt5-default qttools5-dev-tools; fi
      if [ -n "$QT_PPA" ]; then sudo apt-get install -qq "${QT_BASE}base" "${QT_BASE}tools"; source "/opt/${QT_BASE}/bin/${QT_BASE}-env.sh"; fi
    fi
    
script:
  - mkdir build && cd build && qmake ../librepcb.pro -r "QMAKE_CXX=$CXX" "QMAKE_CC=$CC" && make -j8 && cd ../   # build librepcb
  - sudo make install DESTDIR=/app
  - sudo wget "https://github.com/probonopd/linuxdeployqt/releases/download/1/linuxdeployqt-1-x86_64.AppImage" -O /usr/local/bin/linuxdeployqt
  - sudo chmod a+x /usr/local/bin/linuxdeployqt
  - linuxdeployqt /app/usr/bin/librepcb || true
  - find /app/usr/bin/librepcb
